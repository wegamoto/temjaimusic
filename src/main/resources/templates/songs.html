<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="th">
<head>
    <script data-ad-client="ca-pub-2433635593676545" async
            src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

    <meta charset="UTF-8" />
    <title>TemjaiMusic - ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏•‡∏á</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;500;700&display=swap" rel="stylesheet" />
    <style>
        body {
            font-family: 'Noto Sans Thai', sans-serif;
        }
    </style>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body class="bg-gradient-to-br from-blue-50 to-white text-gray-800 font-sans min-h-screen">
<div class="flex flex-col lg:flex-row max-w-[1600px] mx-auto px-4">

    <!-- Sidebar ‡∏ã‡πâ‡∏≤‡∏¢ -->
    <aside class="w-full lg:w-1/6 hidden lg:block p-4">
        <div class="bg-yellow-100 p-4 rounded-xl shadow text-sm text-center">
            <p class="font-bold text-yellow-800 mb-2">üéØ ‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤</p>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-2433635593676545"
                 data-ad-slot="6779833598"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            <p class="text-yellow-700 mt-2">‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì</p>
        </div>
    </aside>

    <!-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÄ‡∏û‡∏•‡∏á -->
    <main class="w-full lg:flex-1 p-4 max-w-5xl mx-auto">
        <h1 class="text-4xl font-extrabold text-center text-blue-700 mb-10 drop-shadow-sm">üéµ TemjaiMusic - ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏•‡∏á</h1>

        <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ -->
        <form action="#" method="get" class="mb-8 flex flex-col md:flex-row items-stretch gap-3">
            <input type="text" name="keyword" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏û‡∏•‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô"
                   th:value="${keyword}" class="flex-1 px-5 py-3 rounded-2xl border border-gray-300 focus:ring-2 focus:ring-blue-400 shadow-sm" />
            <button type="submit"
                    class="bg-blue-600 text-white px-6 py-3 rounded-2xl shadow hover:bg-blue-700 transition">
                ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
            </button>
        </form>

        <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏•‡∏á‡πÉ‡∏´‡∏°‡πà -->
        <div class="mb-12 flex justify-end gap-4 flex-wrap">
            <button onclick="playPlaylist()"
                    class="bg-indigo-600 text-white px-6 py-3 rounded-2xl shadow hover:bg-indigo-700 transition">
                ‚ñ∂Ô∏è ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </button>
            <a href="/songs/new"
               class="inline-block bg-green-600 text-white px-5 py-3 rounded-2xl shadow hover:bg-green-700 transition">
                + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏•‡∏á‡πÉ‡∏´‡∏°‡πà
            </a>
        </div>

        <!-- ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏û‡∏•‡∏á -->
        <div class="bg-gray-900 text-white px-6 py-4 rounded-2xl flex justify-center items-center gap-6 shadow-lg w-full mt-6">
            <button onclick="toggleShuffle()" id="shuffleBtn" title="‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏•‡∏á">
                <svg class="w-6 h-6 opacity-50 hover:opacity-100 transition" fill="none" stroke="currentColor" stroke-width="2"
                     viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 4l16 16M20 4h-6M4 20h6M15 9l5-5M15 15l5 5"></path>
                </svg>
            </button>
            <button onclick="playPrevious()" title="‡πÄ‡∏û‡∏•‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤">
                <svg class="w-6 h-6 hover:text-blue-400 transition" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M11 5.882v8.235L5 10l6-4.118zM13 5h2v10h-2V5z" />
                </svg>
            </button>
            <button onclick="togglePlay()" title="‡πÄ‡∏•‡πà‡∏ô / ‡∏´‡∏¢‡∏∏‡∏î">
                <svg id="playIcon" class="w-8 h-8 hover:text-green-400 transition" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M6 4l10 6-10 6V4z" />
                </svg>
            </button>
            <button onclick="playNext()" title="‡πÄ‡∏û‡∏•‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ">
                <svg class="w-6 h-6 hover:text-blue-400 transition" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9 5.882v8.235L15 10l-6-4.118zM7 5h-2v10h2V5z" />
                </svg>
            </button>
            <button onclick="toggleRepeat()" id="repeatBtn" title="‡πÄ‡∏•‡πà‡∏ô‡∏ã‡πâ‡∏≥">
                <svg class="w-6 h-6 opacity-50 hover:opacity-100 transition" fill="none" stroke="currentColor" stroke-width="2"
                     viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 4v6h6M20 20v-6h-6M4 20h16M20 4H4"></path>
                </svg>
            </button>
        </div>

        <!-- Player (‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°) -->
        <audio id="playlistPlayer" controls class="w-full hidden mt-4"></audio>

        <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° -->
        <div class="h-6"></div>

        <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏•‡∏á -->
        <div class="grid gap-6" th:if="${songs.size() > 0}">
            <div th:each="song : ${songs}"
                 class="bg-white rounded-3xl shadow-lg p-6 flex flex-col md:flex-row items-start md:items-center justify-between hover:shadow-xl transition-all duration-200">

                <div class="flex-1">
                    <h2 class="text-2xl font-semibold text-gray-900 mb-1" th:text="${song.title}">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏•‡∏á</h2>
                    <p class="text-gray-700 text-lg mb-2" th:text="${song.artist}">‡∏ä‡∏∑‡πà‡∏≠‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô</p>
                    <p class="text-sm text-pink-600 font-medium" th:if="${song.genre}" th:text="'‡πÅ‡∏ô‡∏ß‡πÄ‡∏û‡∏•‡∏á: ' + ${song.genre}"></p>
                    <div class="flex flex-wrap gap-2 mt-3" th:if="${song.tags}">
                        <span th:each="tag : ${song.tags}"
                              class="bg-blue-100 text-blue-700 text-xs px-3 py-1 rounded-full shadow-sm"
                              th:text="${tag}">Tag</span>
                    </div>
                </div>

                <div class="mt-5 md:mt-0 flex flex-wrap gap-3 items-center">
                    <audio controls
                           th:if="${song.mp3Url != null}"
                           th:src="${song.mp3Url}"
                           type="audio/mpeg"
                           class="h-10 max-w-xs rounded shadow"
                           preload="none">
                        Your browser does not support the audio element.
                    </audio>

                    <a th:href="@{'/songs/' + ${song.id}}"
                       class="bg-blue-600 text-white px-4 py-2 rounded-xl hover:bg-blue-700 transition shadow">
                        üé§ ‡∏î‡∏π‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏á
                    </a>
                </div>
            </div>
        </div>

        <div th:if="${songs.size() == 0}"
             class="text-center text-gray-600 bg-yellow-50 p-6 rounded-2xl border border-yellow-300 mt-10 shadow">
            <p class="text-xl font-medium mb-2">‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>
            <p th:if="${keyword}" class="text-base">‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô: <span class="font-semibold text-gray-800" th:text="${keyword}"></span></p>
            <a href="/songs" class="mt-4 inline-block text-blue-600 hover:underline">üîÅ ‡∏î‡∏π‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a>
        </div>
    </main>

    <!-- Sidebar ‡∏Ç‡∏ß‡∏≤ -->
    <aside class="w-1/6 hidden lg:block p-4">
        <div class="bg-yellow-100 p-4 rounded-xl shadow text-sm text-center">
            <p class="font-bold text-yellow-800 mb-2">üí° ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</p>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-2433635593676545"
                 data-ad-slot="6779833598"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            <p class="text-yellow-700 mt-2">‡∏ü‡∏±‡∏á‡πÄ‡∏û‡∏•‡∏á‡πÉ‡∏´‡∏°‡πà‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏Ñ‡∏£!</p>
        </div>
    </aside>

</div>

<!-- Scripts -->
<script>
    let playlist = [];
    let currentTrackIndex = 0;
    let isShuffle = false;
    let isRepeat = false;

    const player = document.getElementById("playlistPlayer");
    const playIcon = document.getElementById("playIcon");
    const shuffleBtn = document.getElementById("shuffleBtn");
    const repeatBtn = document.getElementById("repeatBtn");

    function buildPlaylist() {
        playlist = Array.from(document.querySelectorAll("audio"))
            .map(a => a.src)
            .filter(url => url && url.startsWith("http"));
    }

    function playPlaylist() {
        buildPlaylist();
        if (playlist.length === 0) return alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏û‡∏•‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πà‡∏ô");
        currentTrackIndex = 0;
        player.src = playlist[currentTrackIndex];
        player.classList.remove("hidden");
        player.play();
    }

    function playNext() {
        if (isShuffle) {
            currentTrackIndex = Math.floor(Math.random() * playlist.length);
        } else {
            currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
        }
        player.src = playlist[currentTrackIndex];
        player.play();
    }

    function playPrevious() {
        currentTrackIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length;
        player.src = playlist[currentTrackIndex];
        player.play();
    }

    function togglePlay() {
    // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏•‡∏¢
    if (!player.src || player.src === window.location.href) {
        playPlaylist();
        playIcon.innerHTML = '<path d="M6 4h4v12H6zM10 4h4v12h-4z"/>'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô pause icon
        return;
    }

    // toggle ‡πÄ‡∏•‡πà‡∏ô/‡∏´‡∏¢‡∏∏‡∏î
    if (player.paused) {
        player.play();
        playIcon.innerHTML = '<path d="M6 4h4v12H6zM10 4h4v12h-4z"/>'; // pause icon
    } else {
        player.pause();
        playIcon.innerHTML = '<path d="M6 4l10 6-10 6V4z"/>'; // play icon
    }
}

    function toggleShuffle() {
        isShuffle = !isShuffle;
        shuffleBtn.classList.toggle("text-yellow-400", isShuffle);
    }

    function toggleRepeat() {
        isRepeat = !isRepeat;
        repeatBtn.classList.toggle("text-green-400", isRepeat);
    }

    player.addEventListener("ended", () => {
        if (isRepeat) {
            player.play();
        } else {
            playNext();
        }
    });
</script>
</body>
</html>
